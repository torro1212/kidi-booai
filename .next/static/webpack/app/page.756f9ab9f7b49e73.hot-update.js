"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/page",{

/***/ "(app-pages-browser)/./services/geminiService.ts":
/*!***********************************!*\
  !*** ./services/geminiService.ts ***!
  \***********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   analyzeBookPdf: () => (/* binding */ analyzeBookPdf),\n/* harmony export */   generateBookContent: () => (/* binding */ generateBookContent),\n/* harmony export */   generatePageAudio: () => (/* binding */ generatePageAudio),\n/* harmony export */   generatePageImage: () => (/* binding */ generatePageImage),\n/* harmony export */   generateStoryIdea: () => (/* binding */ generateStoryIdea)\n/* harmony export */ });\n/* harmony import */ var _google_genai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/genai */ \"(app-pages-browser)/./node_modules/@google/genai/dist/web/index.mjs\");\n/* harmony import */ var _apiKeyManager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./apiKeyManager */ \"(app-pages-browser)/./services/apiKeyManager.ts\");\n\n\n// Helper to get API key\nconst getApiKey = ()=>{\n    const key = _apiKeyManager__WEBPACK_IMPORTED_MODULE_1__.apiKeyManager.getKey();\n    if (!key) {\n        throw new Error('API key not configured');\n    }\n    return key;\n};\n// Helper to check for fatal auth/quota errors\nconst handleFatalError = (err)=>{\n    // Inspect if the error is wrapped in an 'error' property (common in Google JSON responses)\n    const errorObj = (err === null || err === void 0 ? void 0 : err.error) || err;\n    const msg = ((errorObj === null || errorObj === void 0 ? void 0 : errorObj.message) || JSON.stringify(err)).toLowerCase();\n    const status = (errorObj === null || errorObj === void 0 ? void 0 : errorObj.status) || (errorObj === null || errorObj === void 0 ? void 0 : errorObj.code);\n    // Check for Quota issues\n    const isQuota = status === 429 || status === 'RESOURCE_EXHAUSTED' || msg.includes(\"quota\") || msg.includes(\"resource_exhausted\") || // Specific check for \"limit: 0\" which often means model not available in plan or exhausted\n    msg.includes(\"limit: 0\");\n    // Check for Auth issues (Invalid Key, Expired Key, Project not found)\n    const isAuth = status === 403 || // Status 400 is normally Invalid Argument, but if message says \"API key expired\", it's auth.\n    status === 400 && (msg.includes(\"api key\") || msg.includes(\"expired\")) || msg.includes(\"api key\") || msg.includes(\"unauthenticated\") || msg.includes(\"permission denied\") || msg.includes(\"requested entity was not found\") || msg.includes(\"expired\");\n    if (isQuota || isAuth) {\n        console.warn(\"Fatal API Error (\".concat(isQuota ? 'Quota' : 'Auth', \"). Triggering Re-auth.\"), err);\n        window.dispatchEvent(new CustomEvent('reselect-api-key'));\n        return true;\n    }\n    return false;\n};\n// Helper for retry logic with exponential backoff\nasync function retryWithBackoff(fn) {\n    let retries = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 3, baseDelay = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : 1000;\n    try {\n        return await fn();\n    } catch (error) {\n        // Check for fatal errors first. If fatal, do not retry.\n        if (handleFatalError(error)) {\n            throw error;\n        }\n        const status = error.status || error.code;\n        const message = (error.message || '').toLowerCase();\n        // Check if error is retryable (Transient 5xx server errors)\n        // Note: We handled 429/Quota above as fatal because usually in this context implies Daily Limit, not just QPM.\n        const isRetryable = status && [\n            500,\n            503\n        ].includes(status) || message.includes('internal') || message.includes('overloaded') || message.includes('timeout');\n        if (retries > 0 && isRetryable) {\n            console.warn(\"Retrying operation due to error: \".concat(message, \". Attempts left: \").concat(retries, \". Waiting \").concat(baseDelay, \"ms.\"));\n            await new Promise((resolve)=>setTimeout(resolve, baseDelay));\n            return retryWithBackoff(fn, retries - 1, baseDelay * 2);\n        }\n        throw error;\n    }\n}\n// Define the response schema for the book using the Type enum\nconst bookSchema = {\n    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.OBJECT,\n    properties: {\n        metadata: {\n            type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.OBJECT,\n            properties: {\n                title: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"The title of the book in Hebrew ONLY. Do NOT include English translation.\"\n                },\n                targetAge: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                },\n                mainTheme: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                },\n                educationalMessage: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                },\n                artStyle: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"Detailed description of the art style.\"\n                },\n                mainCharacterDescription: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"Comprehensive physical description of the MAIN character (clothing, hair, accessories). Be very specific about colors.\"\n                },\n                mainCharacterDistinctiveMark: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"A specific, unique visual feature for the main character that acts as a visual anchor (e.g., 'big red glasses', 'a star patch on the overalls', 'a glowing blue pendant', 'a purple feather in hat'). This MUST be included in every single image description.\"\n                },\n                secondaryCharacterDescription: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"If there is a constant companion (animal, friend, sibling) that appears in multiple pages, describe them here with EXTREME DETAIL. Include: Species, Color (specific shade), Size, Accessories, and Distinctive Marks. e.g. 'A rotund bright-yellow chick with large anime-style blue eyes, a tiny orange beak, and wearing a miniature red wool scarf'. This description MUST be unique and unchanging.\"\n                },\n                secondaryCharacterDistinctiveMark: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"A specific, unique visual feature for the secondary character (if present) that acts as a visual anchor.\"\n                },\n                keyObjectDescription: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    description: \"Description of any recurring magical or key object.\"\n                },\n                titlePrimaryColor: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                },\n                titleSecondaryColor: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                },\n                titleEffectTheme: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                    enum: [\n                        'magical',\n                        'natural',\n                        'tech',\n                        'classic',\n                        'playful',\n                        'elegant'\n                    ]\n                },\n                visualConsistencyGuide: {\n                    type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.OBJECT,\n                    properties: {\n                        characterTraits: {\n                            type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.ARRAY,\n                            items: {\n                                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                            }\n                        },\n                        objectTraits: {\n                            type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.ARRAY,\n                            items: {\n                                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                            }\n                        },\n                        backgroundStyle: {\n                            type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                        }\n                    },\n                    required: [\n                        \"characterTraits\",\n                        \"objectTraits\",\n                        \"backgroundStyle\"\n                    ]\n                }\n            },\n            required: [\n                \"title\",\n                \"targetAge\",\n                \"mainTheme\",\n                \"educationalMessage\",\n                \"mainCharacterDescription\",\n                \"mainCharacterDistinctiveMark\",\n                \"artStyle\",\n                \"keyObjectDescription\",\n                \"titlePrimaryColor\",\n                \"titleSecondaryColor\",\n                \"titleEffectTheme\",\n                \"visualConsistencyGuide\"\n            ]\n        },\n        pages: {\n            type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.ARRAY,\n            items: {\n                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.OBJECT,\n                properties: {\n                    pageNumber: {\n                        type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.INTEGER\n                    },\n                    hebrewText: {\n                        type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n                    },\n                    imagePrompt: {\n                        type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING,\n                        description: \"Detailed ENGLISH visual scene description. IMPORTANT: Describe a SPECIFIC CAMERA ANGLE (e.g., 'Close-up on face', 'Wide shot from above', 'Low angle looking up') and SPECIFIC BACKGROUND DETAILS relevant to the action. Do NOT just say 'in the forest'. Say 'next to a giant oak tree with sunlight filtering through'.\"\n                    }\n                },\n                required: [\n                    \"pageNumber\",\n                    \"hebrewText\",\n                    \"imagePrompt\"\n                ]\n            }\n        }\n    },\n    required: [\n        \"metadata\",\n        \"pages\"\n    ]\n};\nconst generateStoryIdea = async (ageRange, currentTopic)=>{\n    const ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n        apiKey: getApiKey()\n    });\n    const prompt = \"You are a creative children's book editor. \\n  The user wants an idea for a book.\\n  Target Age: \".concat(ageRange, \"\\n  User's rough idea (optional): \\\"\").concat(currentTopic, '\"\\n\\n  Please generate a short, structured concept in HEBREW (עברית).\\n  Structure:\\n  1. שם הספר (Title)\\n  2. דמות ראשית (Main Character - Name + A unique visual trait/mark)\\n  3. תקציר העלילה (Short Plot Summary)\\n  \\n  Make it engaging, magical, and suitable for the age group. \\n  Do not include markdown formatting like ** or ##. Just clean text.');\n    try {\n        // Using flash for speed\n        const response = await retryWithBackoff(()=>ai.models.generateContent({\n                model: 'gemini-3-flash-preview',\n                contents: {\n                    parts: [\n                        {\n                            text: prompt\n                        }\n                    ]\n                },\n                config: {\n                    maxOutputTokens: 300\n                }\n            }));\n        return response.text || \"\";\n    } catch (error) {\n        console.error(\"Error generating idea:\", error);\n        // If handleFatalError returns true, it's a critical auth/quota error and we let the UI redirect.\n        // If it returns false, we throw so the component can show a specific alert.\n        if (!handleFatalError(error)) {\n            throw error;\n        }\n        return \"\";\n    }\n};\nconst generateBookContent = async (request)=>{\n    // Copyright check before generation\n    const { validateBookRequest, logGeneratedBook } = await __webpack_require__.e(/*! import() */ \"_app-pages-browser_services_promptGuard_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./promptGuard */ \"(app-pages-browser)/./services/promptGuard.ts\"));\n    const copyrightCheck = await validateBookRequest(request.topic);\n    if (!copyrightCheck.allowed) {\n        throw new Error(copyrightCheck.reason || 'Content blocked');\n    }\n    const ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n        apiKey: getApiKey()\n    });\n    const systemInstruction = \"You are a world-class children's book author and art director.\\n  \\n  TASK: Create a magical children's book in Hebrew with detailed English art direction.\\n  \\n  STRICT PAGE COUNT: EXACTLY \".concat(request.pageCount, ' pages.\\n  \\n  GUIDELINES:\\n  1. STORY (Hebrew): Engaging, age-appropriate, perfect grammar.\\n     - CRITICAL: The \\'title\\' in metadata MUST be in Hebrew ONLY. Do not include an English translation.\\n  2. ART DIRECTION (English):\\n     - \\'mainCharacterDescription\\': A precise, unchanging visual definition.\\n     - \\'mainCharacterDistinctiveMark\\': CREATE A UNIQUE IDENTIFIER (e.g., \"Rainbow Scarf\", \"Golden Goggles\"). This is CRITICAL for consistency.\\n     - \\'visualConsistencyGuide\\': List specific items/colors that MUST appear in every image.\\n     - \\'imagePrompt\\' (for each page): A FULL SCENE DESCRIPTION. \\n  3. VISUAL VARIETY (CRITICAL):\\n     - **VARY CAMERA ANGLES**: Do NOT use the same \"medium shot\" for every page. Use Close-ups, Wide shots, Bird\\'s-eye view, Low angles.\\n     - **VARY BACKGROUNDS**: Even if the setting is the same (e.g., a forest), focus on DIFFERENT parts of it (e.g., \"next to a stream\", \"inside a hollow log\", \"looking up at the canopy\").\\n     - **DYNAMIC ACTION**: Characters should be doing different things, not just standing.\\n  4. COMPOSITION AWARENESS:\\n     - The images must be FULL BLEED, filling the entire square 1:1 canvas.\\n     - Center the action.\\n     - Do NOT leave empty space for text. Text will be added externally.\\n  ');\n    let prompt = \"Create a children's book.\\n  Target Age: \".concat(request.ageRange, \"\\n  Topic: \").concat(request.topic, \"\\n  REQUIRED LENGTH: EXACTLY \").concat(request.pageCount, \" pages. Start with page 1 as the cover and end with page \").concat(request.pageCount, \".\\n  Art Style Selection: \").concat(request.artStyle);\n    if (request.previousContext) {\n        prompt += '\\n    SEQUEL MODE: Maintain character consistency with the previous story: \"'.concat(request.previousContext.title, '\".\\n    Previous Main Character: ').concat(request.previousContext.characterDescription, \".\\n    \").concat(request.previousContext.secondaryCharacterDescription ? \"Previous Secondary Character: \".concat(request.previousContext.secondaryCharacterDescription) : '', \"\\n    \");\n    }\n    try {\n        var _request_previousContext;\n        const response = await retryWithBackoff(()=>ai.models.generateContent({\n                model: 'gemini-3-pro-preview',\n                contents: prompt,\n                config: {\n                    responseMimeType: 'application/json',\n                    responseSchema: bookSchema,\n                    systemInstruction: systemInstruction\n                }\n            }));\n        if (!response.text) {\n            throw new Error(\"Failed to generate book content\");\n        }\n        const book = JSON.parse(response.text);\n        // Safety check for page count\n        console.log(\"Requested \".concat(request.pageCount, \" pages, received \").concat(book.pages.length, \" pages.\"));\n        // Inject Audio Configuration from Request\n        book.metadata.audioConfig = {\n            enabled: request.audioEnabled,\n            voiceName: request.voiceName\n        };\n        if ((_request_previousContext = request.previousContext) === null || _request_previousContext === void 0 ? void 0 : _request_previousContext.baseCharacterImage) {\n            book.metadata.baseCharacterImageUrl = request.previousContext.baseCharacterImage;\n        }\n        // Refine all image prompts to include the consistency guide for BOTH characters\n        const traits = book.metadata.visualConsistencyGuide.characterTraits.join(\", \");\n        const objTraits = book.metadata.visualConsistencyGuide.objectTraits.join(\", \");\n        const mainMark = book.metadata.mainCharacterDistinctiveMark || \"Distinctive feature\";\n        const secMark = book.metadata.secondaryCharacterDistinctiveMark;\n        book.pages = book.pages.map((page, idx)=>{\n            // 1. Establish the visual anchor (Characters & Style)\n            let refinedPrompt = \"[MAIN CHARACTER]: \".concat(book.metadata.mainCharacterDescription, \". DISTINCTIVE FEATURE: \").concat(mainMark, \". Key Features: \").concat(traits, \". \");\n            if (book.metadata.secondaryCharacterDescription) {\n                refinedPrompt += \"[SECONDARY CHARACTER]: \".concat(book.metadata.secondaryCharacterDescription, \". DISTINCTIVE FEATURE: \").concat(secMark || 'None', \". \");\n            }\n            // 2. Set the Environment/Atmosphere \n            // NOTE: We label this \"General Context\" so it doesn't override the specific scene action\n            refinedPrompt += \"[GENERAL CONTEXT]: \".concat(book.metadata.visualConsistencyGuide.backgroundStyle, \". \");\n            if (objTraits) refinedPrompt += \"[PROPS]: \".concat(objTraits, \". \");\n            // 3. Define the specific scene action - THIS IS PRIORITY\n            refinedPrompt += \"[SPECIFIC SCENE ACTION & ANGLE]: \".concat(page.imagePrompt, \". \");\n            return {\n                ...page,\n                imagePrompt: refinedPrompt\n            };\n        });\n        // Don't save here - saved during export instead\n        return book;\n    } catch (error) {\n        console.error(\"Error generating book content:\", error);\n        // Extra catch just in case retryWithBackoff didn't catch it\n        handleFatalError(error);\n        throw error;\n    }\n};\nconst generatePageImage = async function(actionPrompt, characterDescription, artStyle, baseCharacterImageUrl) {\n    let isCover = arguments.length > 4 && arguments[4] !== void 0 ? arguments[4] : false, textToRender = arguments.length > 5 ? arguments[5] : void 0;\n    const ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n        apiKey: getApiKey()\n    });\n    let finalPrompt = \"\";\n    let modelName = \"\";\n    let imageConfig = {};\n    if (isCover) {\n        // COVER STRATEGY: Use Pro model, bake text.\n        modelName = 'gemini-3-pro-image-preview';\n        imageConfig = {\n            aspectRatio: \"1:1\",\n            imageSize: \"1K\"\n        };\n        finalPrompt = \"\\n      [ROLE]: Expert Children's Book Cover Designer.\\n      [ART STYLE]: \".concat(artStyle, \".\\n      \\n      [CAST DEFINITIONS]: \\n      \").concat(characterDescription, \"\\n      \\n      [SCENE DESCRIPTION]: \").concat(actionPrompt, '\\n      \\n      [TITLE TEXT - ABSOLUTE REQUIREMENT]:\\n      The ONLY text in this entire image is: \"').concat(textToRender, '\"\\n      \\n      CRITICAL - TEXT RULES:\\n      1. ONLY display the exact title above - NO other text whatsoever\\n      2. ABSOLUTELY NO: subtitle, author, age range, page count, tagline, description\\n      3. ABSOLUTELY NO: \"מחבר\", \"גיל\", \"עמודים\", numbers, credits, watermarks\\n      4. ABSOLUTELY NO: English text, Latin letters, any text not in the title\\n      5. The title should be in the TOP THIRD of the image\\n      6. Use artistic Hebrew font matching ').concat(artStyle, \" style\\n      7. Add glow/shadow behind text for readability\\n      \\n      [CHARACTER]:\\n      1. Main character must match Reference Image (if provided)\\n      2. Character in dynamic, inviting pose\\n      \\n      [TECHNICAL]: 8k resolution, cinematic lighting, vivid colors.\\n      [NEGATIVE PROMPT]: subtitle, author name, page count, age range, English text, extra text, watermark, tagline, credits, מחבר, גיל, עמודים, numbers at bottom, description text, any text besides title.\\n    \");\n    } else {\n        // INNER PAGE STRATEGY: Use Flash model, NO text.\n        modelName = 'gemini-2.5-flash-image';\n        // Enhanced prompt with stronger character consistency\n        finalPrompt = \"\\n      [ROLE]: Professional Children's Book Illustrator specializing in character consistency.\\n      [ART STYLE]: \".concat(artStyle, \".\\n      \\n      [CAST DEFINITIONS - CRITICAL FOR CONSISTENCY]: \\n      \").concat(characterDescription, \"\\n      \\n      [SCENE TO ILLUSTRATE]: \\n      \").concat(actionPrompt, \"\\n      \\n      [CHARACTER CONSISTENCY - MANDATORY]:\\n      1. SAME CHARACTER = IDENTICAL APPEARANCE in every illustration\\n      2. Main character MUST have the EXACT same:\\n         - Face shape and features\\n         - Hair color and style\\n         - Clothing and accessories\\n         - Any distinctive marks mentioned in CAST DEFINITIONS\\n      3. If a Reference Image is provided, the character MUST match it EXACTLY\\n      4. Secondary character (if present) must also be consistent\\n      5. DO NOT change character appearance between pages\\n      \\n      [ILLUSTRATION RULES]:\\n      1. **ABSOLUTELY NO TEXT**: No text, captions, speech bubbles, or words\\n      2. **FULL BLEED**: Use entire canvas, no borders or margins\\n      3. **DYNAMIC COMPOSITION**: Use the camera angle specified in the scene description\\n      \\n      [BACKGROUND INSTRUCTION]: \\n      Match background to the specific scene action described above.\\n      Use varied camera angles (Close-up, Wide shot, Low angle) for visual variety.\\n      \\n      [TECHNICAL SPECS]: 8k resolution, cinematic lighting, vivid saturated colors.\\n      [NEGATIVE]: text, writing, letters, words, watermark, logo, blurry, low quality, inconsistent character, different outfit, changed appearance.\\n    \");\n    }\n    const parts = [\n        {\n            text: finalPrompt\n        }\n    ];\n    // If we have a base character image, we MUST send it as a reference for EVERY page\n    if (baseCharacterImageUrl && baseCharacterImageUrl.startsWith('data:image/')) {\n        const matches = baseCharacterImageUrl.match(/^data:(.+);base64,(.+)$/);\n        if (matches) {\n            parts.unshift({\n                inlineData: {\n                    mimeType: matches[1],\n                    data: matches[2]\n                }\n            });\n            parts.push({\n                text: \"REFERENCE IMAGE INSTRUCTION: The image above is the MAIN character reference. Match this character exactly.\"\n            });\n        }\n    }\n    try {\n        const response = await retryWithBackoff(()=>ai.models.generateContent({\n                model: modelName,\n                contents: {\n                    parts\n                },\n                config: isCover ? {\n                    imageConfig\n                } : undefined\n            }));\n        for (const candidate of response.candidates || []){\n            for (const part of candidate.content.parts){\n                if (part.inlineData && part.inlineData.data) {\n                    return \"data:\".concat(part.inlineData.mimeType, \";base64,\").concat(part.inlineData.data);\n                }\n            }\n        }\n        return null;\n    } catch (error) {\n        console.error(\"Error generating image:\", error);\n        handleFatalError(error);\n        return null;\n    }\n};\nconst analyzeBookPdf = async (pdfBase64)=>{\n    const ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n        apiKey: getApiKey()\n    });\n    const prompt = \"\\n    Analyze this PDF children's book. \\n    Extract the following information to create a sequel context:\\n    1. Title of the book.\\n    2. A summary of the plot.\\n    3. A detailed visual description of the MAIN character (appearance, clothes, hair, colors).\\n    4. A detailed visual description of any SECONDARY character (sidekick) if present.\\n    5. The art style used.\\n    \\n    Return the result as a JSON object.\\n  \";\n    const extractionSchema = {\n        type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.OBJECT,\n        properties: {\n            title: {\n                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n            },\n            summary: {\n                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n            },\n            characterDescription: {\n                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n            },\n            secondaryCharacterDescription: {\n                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n            },\n            artStyle: {\n                type: _google_genai__WEBPACK_IMPORTED_MODULE_0__.Type.STRING\n            }\n        },\n        required: [\n            \"title\",\n            \"summary\",\n            \"characterDescription\",\n            \"artStyle\"\n        ]\n    };\n    try {\n        const response = await retryWithBackoff(()=>ai.models.generateContent({\n                model: 'gemini-3-flash-preview',\n                contents: {\n                    parts: [\n                        {\n                            inlineData: {\n                                mimeType: 'application/pdf',\n                                data: pdfBase64\n                            }\n                        },\n                        {\n                            text: prompt\n                        }\n                    ]\n                },\n                config: {\n                    responseMimeType: 'application/json',\n                    responseSchema: extractionSchema\n                }\n            }));\n        if (!response.text) throw new Error(\"Failed to analyze PDF\");\n        return JSON.parse(response.text);\n    } catch (error) {\n        console.error(\"Error analyzing PDF:\", error);\n        handleFatalError(error);\n        throw error;\n    }\n};\n// AUDIO GENERATION UTILS\n// Decode base64 to binary string to Uint8Array to Int16Array\nfunction decodeAudio(base64) {\n    const binaryString = atob(base64);\n    const len = binaryString.length;\n    const bytes = new Uint8Array(len);\n    for(let i = 0; i < len; i++){\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return new Int16Array(bytes.buffer);\n}\nconst generatePageAudio = async function(text, audioContext) {\n    let voiceName = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : 'Puck';\n    const ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n        apiKey: getApiKey()\n    });\n    // Validate and Truncate Text\n    if (!text || !text.trim()) return null;\n    // Truncate to ~500 chars to avoid 500 Internal Error from TTS model which has input limits\n    const safeText = text.trim().slice(0, 500);\n    const prompt = \"Read the following Hebrew text clearly, slowly, and warmly, suitable for a children's book storytelling:\\n    \\n    \".concat(safeText);\n    try {\n        var _response_candidates__content_parts__inlineData, _response_candidates__content_parts_, _response_candidates__content_parts, _response_candidates__content, _response_candidates_, _response_candidates;\n        const response = await retryWithBackoff(()=>ai.models.generateContent({\n                model: \"gemini-2.5-flash-preview-tts\",\n                contents: [\n                    {\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                config: {\n                    responseModalities: [\n                        _google_genai__WEBPACK_IMPORTED_MODULE_0__.Modality.AUDIO\n                    ],\n                    speechConfig: {\n                        voiceConfig: {\n                            prebuiltVoiceConfig: {\n                                voiceName: voiceName\n                            }\n                        }\n                    }\n                }\n            }));\n        const base64Audio = (_response_candidates = response.candidates) === null || _response_candidates === void 0 ? void 0 : (_response_candidates_ = _response_candidates[0]) === null || _response_candidates_ === void 0 ? void 0 : (_response_candidates__content = _response_candidates_.content) === null || _response_candidates__content === void 0 ? void 0 : (_response_candidates__content_parts = _response_candidates__content.parts) === null || _response_candidates__content_parts === void 0 ? void 0 : (_response_candidates__content_parts_ = _response_candidates__content_parts[0]) === null || _response_candidates__content_parts_ === void 0 ? void 0 : (_response_candidates__content_parts__inlineData = _response_candidates__content_parts_.inlineData) === null || _response_candidates__content_parts__inlineData === void 0 ? void 0 : _response_candidates__content_parts__inlineData.data;\n        if (!base64Audio) return null;\n        // Decode PCM data\n        const pcmData = decodeAudio(base64Audio);\n        // Convert Int16 PCM to Float32 for AudioContext (-1.0 to 1.0)\n        const float32Data = new Float32Array(pcmData.length);\n        for(let i = 0; i < pcmData.length; i++){\n            float32Data[i] = pcmData[i] / 32768.0;\n        }\n        // Create Audio Buffer (Mono, 24kHz as per standard GenAI output usually, but context sample rate matters)\n        // Note: The raw output is usually 24000Hz.\n        const audioBuffer = audioContext.createBuffer(1, float32Data.length, 24000);\n        audioBuffer.getChannelData(0).set(float32Data);\n        return audioBuffer;\n    } catch (error) {\n        console.error(\"Error generating audio:\", error);\n        // Propagate fatal errors to prompt key change\n        handleFatalError(error);\n        return null;\n    }\n};\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL3NlcnZpY2VzL2dlbWluaVNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUNxRjtBQUVyQztBQUVoRCx3QkFBd0I7QUFDeEIsTUFBTUksWUFBWTtJQUNoQixNQUFNQyxNQUFNRix5REFBYUEsQ0FBQ0csTUFBTTtJQUNoQyxJQUFJLENBQUNELEtBQUs7UUFDUixNQUFNLElBQUlFLE1BQU07SUFDbEI7SUFDQSxPQUFPRjtBQUNUO0FBRUEsOENBQThDO0FBQzlDLE1BQU1HLG1CQUFtQixDQUFDQztJQUN4QiwyRkFBMkY7SUFDM0YsTUFBTUMsV0FBV0QsQ0FBQUEsZ0JBQUFBLDBCQUFBQSxJQUFLRSxLQUFLLEtBQUlGO0lBRS9CLE1BQU1HLE1BQU0sQ0FBQ0YsQ0FBQUEscUJBQUFBLCtCQUFBQSxTQUFVRyxPQUFPLEtBQUlDLEtBQUtDLFNBQVMsQ0FBQ04sSUFBRyxFQUFHTyxXQUFXO0lBQ2xFLE1BQU1DLFNBQVNQLENBQUFBLHFCQUFBQSwrQkFBQUEsU0FBVU8sTUFBTSxNQUFJUCxxQkFBQUEsK0JBQUFBLFNBQVVRLElBQUk7SUFFakQseUJBQXlCO0lBQ3pCLE1BQU1DLFVBQ0pGLFdBQVcsT0FDWEEsV0FBVyx3QkFDWEwsSUFBSVEsUUFBUSxDQUFDLFlBQ2JSLElBQUlRLFFBQVEsQ0FBQyx5QkFDYiwyRkFBMkY7SUFDM0ZSLElBQUlRLFFBQVEsQ0FBQztJQUVmLHNFQUFzRTtJQUN0RSxNQUFNQyxTQUNKSixXQUFXLE9BQ1gsNkZBQTZGO0lBQzVGQSxXQUFXLE9BQVFMLENBQUFBLElBQUlRLFFBQVEsQ0FBQyxjQUFjUixJQUFJUSxRQUFRLENBQUMsVUFBUyxLQUNyRVIsSUFBSVEsUUFBUSxDQUFDLGNBQ2JSLElBQUlRLFFBQVEsQ0FBQyxzQkFDYlIsSUFBSVEsUUFBUSxDQUFDLHdCQUNiUixJQUFJUSxRQUFRLENBQUMscUNBQ2JSLElBQUlRLFFBQVEsQ0FBQztJQUVmLElBQUlELFdBQVdFLFFBQVE7UUFDckJDLFFB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LE1BQU0sRUFBRWlELElBQUs7WUFDdkNnQixXQUFXLENBQUNoQixFQUFFLEdBQUdlLE9BQU8sQ0FBQ2YsRUFBRSxHQUFHO1FBQ2hDO1FBRUEsMEdBQTBHO1FBQzFHLDJDQUEyQztRQUMzQyxNQUFNa0IsY0FBY2IsYUFBYWMsWUFBWSxDQUFDLEdBQUdILFlBQVlqRSxNQUFNLEVBQUU7UUFDckVtRSxZQUFZRSxjQUFjLENBQUMsR0FBR0MsR0FBRyxDQUFDTDtRQUVsQyxPQUFPRTtJQUVULEVBQUUsT0FBTzVKLE9BQVk7UUFDbkJXLFFBQVFYLEtBQUssQ0FBQywyQkFBMkJBO1FBRXpDLDhDQUE4QztRQUM5Q0gsaUJBQWlCRztRQUVqQixPQUFPO0lBQ1Q7QUFDRixFQUFDIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXExFTk9WT1xcRGVza3RvcFxcc2hhaGFyXFxib29rYWlcXHNlcnZpY2VzXFxnZW1pbmlTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgR29vZ2xlR2VuQUksIFR5cGUsIE1vZGFsaXR5LCBHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZSB9IGZyb20gXCJAZ29vZ2xlL2dlbmFpXCI7XG5pbXBvcnQgeyBCb29rLCBCb29rUmVxdWVzdCwgUHJldmlvdXNCb29rQ29udGV4dCB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgYXBpS2V5TWFuYWdlciB9IGZyb20gXCIuL2FwaUtleU1hbmFnZXJcIjtcblxuLy8gSGVscGVyIHRvIGdldCBBUEkga2V5XG5jb25zdCBnZXRBcGlLZXkgPSAoKTogc3RyaW5nID0+IHtcbiAgY29uc3Qga2V5ID0gYXBpS2V5TWFuYWdlci5nZXRLZXkoKTtcbiAgaWYgKCFrZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0FQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKTtcbiAgfVxuICByZXR1cm4ga2V5O1xufTtcblxuLy8gSGVscGVyIHRvIGNoZWNrIGZvciBmYXRhbCBhdXRoL3F1b3RhIGVycm9yc1xuY29uc3QgaGFuZGxlRmF0YWxFcnJvciA9IChlcnI6IGFueSkgPT4ge1xuICAvLyBJbnNwZWN0IGlmIHRoZSBlcnJvciBpcyB3cmFwcGVkIGluIGFuICdlcnJvcicgcHJvcGVydHkgKGNvbW1vbiBpbiBHb29nbGUgSlNPTiByZXNwb25zZXMpXG4gIGNvbnN0IGVycm9yT2JqID0gZXJyPy5lcnJvciB8fCBlcnI7XG5cbiAgY29uc3QgbXNnID0gKGVycm9yT2JqPy5tZXNzYWdlIHx8IEpTT04uc3RyaW5naWZ5KGVycikpLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHN0YXR1cyA9IGVycm9yT2JqPy5zdGF0dXMgfHwgZXJyb3JPYmo/LmNvZGU7XG5cbiAgLy8gQ2hlY2sgZm9yIFF1b3RhIGlzc3Vlc1xuICBjb25zdCBpc1F1b3RhID1cbiAgICBzdGF0dXMgPT09IDQyOSB8fFxuICAgIHN0YXR1cyA9PT0gJ1JFU09VUkNFX0VYSEFVU1RFRCcgfHxcbiAgICBtc2cuaW5jbHVkZXMoXCJxdW90YVwiKSB8fFxuICAgIG1zZy5pbmNsdWRlcyhcInJlc291cmNlX2V4aGF1c3RlZFwiKSB8fFxuICAgIC8vIFNwZWNpZmljIGNoZWNrIGZvciBcImxpbWl0OiAwXCIgd2hpY2ggb2Z0ZW4gbWVhbnMgbW9kZWwgbm90IGF2YWlsYWJsZSBpbiBwbGFuIG9yIGV4aGF1c3RlZFxuICAgIG1zZy5pbmNsdWRlcyhcImxpbWl0OiAwXCIpO1xuXG4gIC8vIENoZWNrIGZvciBBdXRoIGlzc3VlcyAoSW52YWxpZCBLZXksIEV4cGlyZWQgS2V5LCBQcm9qZWN0IG5vdCBmb3VuZClcbiAgY29uc3QgaXNBdXRoID1cbiAgICBzdGF0dXMgPT09IDQwMyB8fFxuICAgIC8vIFN0YXR1cyA0MDAgaXMgbm9ybWFsbHkgSW52YWxpZCBBcmd1bWVudCwgYnV0IGlmIG1lc3NhZ2Ugc2F5cyBcIkFQSSBrZXkgZXhwaXJlZFwiLCBpdCdzIGF1dGguXG4gICAgKHN0YXR1cyA9PT0gNDAwICYmIChtc2cuaW5jbHVkZXMoXCJhcGkga2V5XCIpIHx8IG1zZy5pbmNsdWRlcyhcImV4cGlyZWRcIikpKSB8fFxuICAgIG1zZy5pbmNsdWRlcyhcImFwaSBrZXlcIikgfHxcbiAgICBtc2cuaW5jbHVkZXMoXCJ1bmF1dGhlbnRpY2F0ZWRcIikgfHxcbiAgICBtc2cuaW5jbHVkZXMoXCJwZXJtaXNzaW9uIGRlbmllZFwiKSB8fFxuICAgIG1zZy5pbmNsdWRlcyhcInJlcXVlc3RlZCBlbnRpdHkgd2FzIG5vdCBmb3VuZFwiKSB8fFxuICAgIG1zZy5pbmNsdWRlcyhcImV4cGlyZWRcIik7XG5cbiAgaWYgKGlzUXVvdGEgfHwgaXNBdXRoKSB7XG4gICAgY29uc29sZS53YXJuKGBGYXRhbCBBUEkgRXJyb3IgKCR7aXNRdW90YSA/ICdRdW90YScgOiAnQXV0aCd9KS4gVHJpZ2dlcmluZyBSZS1hdXRoLmAsIGVycik7XG4gICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdyZXNlbGVjdC1hcGkta2V5JykpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8vIEhlbHBlciBmb3IgcmV0cnkgbG9naWMgd2l0aCBleHBvbmVudGlhbCBiYWNrb2ZmXG5hc3luYyBmdW5jdGlvbiByZXRyeVdpdGhCYWNrb2ZmPFQ+KFxuICBmbjogKCkgPT4gUHJvbWlzZTxUPixcbiAgcmV0cmllcyA9IDMsXG4gIGJhc2VEZWxheSA9IDEwMDBcbik6IFByb21pc2U8VD4ge1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBmbigpO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgLy8gQ2hlY2sgZm9yIGZhdGFsIGVycm9ycyBmaXJzdC4gSWYgZmF0YWwsIGRvIG5vdCByZXRyeS5cbiAgICBpZiAoaGFuZGxlRmF0YWxFcnJvcihlcnJvcikpIHtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXR1cyA9IGVycm9yLnN0YXR1cyB8fCBlcnJvci5jb2RlO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSAoZXJyb3IubWVzc2FnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIENoZWNrIGlmIGVycm9yIGlzIHJldHJ5YWJsZSAoVHJhbnNpZW50IDV4eCBzZXJ2ZXIgZXJyb3JzKVxuICAgIC8vIE5vdGU6IFdlIGhhbmRsZWQgNDI5L1F1b3RhIGFib3ZlIGFzIGZhdGFsIGJlY2F1c2UgdXN1YWxseSBpbiB0aGlzIGNvbnRleHQgaW1wbGllcyBEYWlseSBMaW1pdCwgbm90IGp1c3QgUVBNLlxuICAgIGNvbnN0IGlzUmV0cnlhYmxlID1cbiAgICAgIChzdGF0dXMgJiYgWzUwMCwgNTAzXS5pbmNsdWRlcyhzdGF0dXMpKSB8fFxuICAgICAgKG1lc3NhZ2UuaW5jbHVkZXMoJ2ludGVybmFsJykgfHxcbiAgICAgICAgbWVzc2FnZS5pbmNsdWRlcygnb3ZlcmxvYWRlZCcpIHx8XG4gICAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ3RpbWVvdXQnKSk7XG5cbiAgICBpZiAocmV0cmllcyA+IDAgJiYgaXNSZXRyeWFibGUpIHtcbiAgICAgIGNvbnNvbGUud2FybihgUmV0cnlpbmcgb3BlcmF0aW9uIGR1ZSB0byBlcnJvcjogJHttZXNzYWdlfS4gQXR0ZW1wdHMgbGVmdDogJHtyZXRyaWVzfS4gV2FpdGluZyAke2Jhc2VEZWxheX1tcy5gKTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBiYXNlRGVsYXkpKTtcbiAgICAgIHJldHVybiByZXRyeVdpdGhCYWNrb2ZmKGZuLCByZXRyaWVzIC0gMSwgYmFzZURlbGF5ICogMik7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIERlZmluZSB0aGUgcmVzcG9uc2Ugc2NoZW1hIGZvciB0aGUgYm9vayB1c2luZyB0aGUgVHlwZSBlbnVtXG5jb25zdCBib29rU2NoZW1hID0ge1xuICB0eXBlOiBUeXBlLk9CSkVDVCxcbiAgcHJvcGVydGllczoge1xuICAgIG1ldGFkYXRhOiB7XG4gICAgICB0eXBlOiBUeXBlLk9CSkVDVCxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICB0eXBlOiBUeXBlLlNUUklORyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgdGl0bGUgb2YgdGhlIGJvb2sgaW4gSGVicmV3IE9OTFkuIERvIE5PVCBpbmNsdWRlIEVuZ2xpc2ggdHJhbnNsYXRpb24uXCJcbiAgICAgICAgfSxcbiAgICAgICAgdGFyZ2V0QWdlOiB7IHR5cGU6IFR5cGUuU1RSSU5HIH0sXG4gICAgICAgIG1haW5UaGVtZTogeyB0eXBlOiBUeXBlLlNUUklORyB9LFxuICAgICAgICBlZHVjYXRpb25hbE1lc3NhZ2U6IHsgdHlwZTogVHlwZS5TVFJJTkcgfSxcbiAgICAgICAgYXJ0U3R5bGU6IHtcbiAgICAgICAgICB0eXBlOiBUeXBlLlNUUklORyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJEZXRhaWxlZCBkZXNjcmlwdGlvbiBvZiB0aGUgYXJ0IHN0eWxlLlwiXG4gICAgICAgIH0sXG4gICAgICAgIG1haW5DaGFyYWN0ZXJEZXNjcmlwdGlvbjoge1xuICAgICAgICAgIHR5cGU6IFR5cGUuU1RSSU5HLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkNvbXByZWhlbnNpdmUgcGh5c2ljYWwgZGVzY3JpcHRpb24gb2YgdGhlIE1BSU4gY2hhcmFjdGVyIChjbG90aGluZywgaGFpciwgYWNjZXNzb3JpZXMpLiBCZSB2ZXJ5IHNwZWNpZmljIGFib3V0IGNvbG9ycy5cIlxuICAgICAgICB9LFxuICAgICAgICBtYWluQ2hhcmFjdGVyRGlzdGluY3RpdmVNYXJrOiB7XG4gICAgICAgICAgdHlwZTogVHlwZS5TVFJJTkcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiQSBzcGVjaWZpYywgdW5pcXVlIHZpc3VhbCBmZWF0dXJlIGZvciB0aGUgbWFpbiBjaGFyYWN0ZXIgdGhhdCBhY3RzIGFzIGEgdmlzdWFsIGFuY2hvciAoZS5nLiwgJ2JpZyByZWQgZ2xhc3NlcycsICdhIHN0YXIgcGF0Y2ggb24gdGhlIG92ZXJhbGxzJywgJ2EgZ2xvd2luZyBibHVlIHBlbmRhbnQnLCAnYSBwdXJwbGUgZmVhdGhlciBpbiBoYXQnKS4gVGhpcyBNVVNUIGJlIGluY2x1ZGVkIGluIGV2ZXJ5IHNpbmdsZSBpbWFnZSBkZXNjcmlwdGlvbi5cIlxuICAgICAgICB9LFxuICAgICAgICBzZWNvbmRhcnlDaGFyYWN0ZXJEZXNjcmlwdGlvbjoge1xuICAgICAgICAgIHR5cGU6IFR5cGUuU1RSSU5HLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIklmIHRoZXJlIGlzIGEgY29uc3RhbnQgY29tcGFuaW9uIChhbmltYWwsIGZyaWVuZCwgc2libGluZykgdGhhdCBhcHBlYXJzIGluIG11bHRpcGxlIHBhZ2VzLCBkZXNjcmliZSB0aGVtIGhlcmUgd2l0aCBFWFRSRU1FIERFVEFJTC4gSW5jbHVkZTogU3BlY2llcywgQ29sb3IgKHNwZWNpZmljIHNoYWRlKSwgU2l6ZSwgQWNjZXNzb3JpZXMsIGFuZCBEaXN0aW5jdGl2ZSBNYXJrcy4gZS5nLiAnQSByb3R1bmQgYnJpZ2h0LXllbGxvdyBjaGljayB3aXRoIGxhcmdlIGFuaW1lLXN0eWxlIGJsdWUgZXllcywgYSB0aW55IG9yYW5nZSBiZWFrLCBhbmQgd2VhcmluZyBhIG1pbmlhdHVyZSByZWQgd29vbCBzY2FyZicuIFRoaXMgZGVzY3JpcHRpb24gTVVTVCBiZSB1bmlxdWUgYW5kIHVuY2hhbmdpbmcuXCJcbiAgICAgICAgfSxcbiAgICAgICAgc2Vjb25kYXJ5Q2hhcmFjdGVyRGlzdGluY3RpdmVNYXJrOiB7XG4gICAgICAgICAgdHlwZTogVHlwZS5TVFJJTkcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiQSBzcGVjaWZpYywgdW5pcXVlIHZpc3VhbCBmZWF0dXJlIGZvciB0aGUgc2Vjb25kYXJ5IGNoYXJhY3RlciAoaWYgcHJlc2VudCkgdGhhdCBhY3RzIGFzIGEgdmlzdWFsIGFuY2hvci5cIlxuICAgICAgICB9LFxuICAgICAgICBrZXlPYmplY3REZXNjcmlwdGlvbjoge1xuICAgICAgICAgIHR5cGU6IFR5cGUuU1RSSU5HLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkRlc2NyaXB0aW9uIG9mIGFueSByZWN1cnJpbmcgbWFnaWNhbCBvciBrZXkgb2JqZWN0LlwiXG4gICAgICAgIH0sXG4gICAgICAgIHRpdGxlUHJpbWFyeUNvbG9yOiB7IHR5cGU6IFR5cGUuU1RSSU5HIH0sXG4gICAgICAgIHRpdGxlU2Vjb25kYXJ5Q29sb3I6IHsgdHlwZTogVHlwZS5TVFJJTkcgfSxcbiAgICAgICAgdGl0bGVFZmZlY3RUaGVtZToge1xuICAgICAgICAgIHR5cGU6IFR5cGUuU1RSSU5HLFxuICAgICAgICAgIGVudW06IFsnbWFnaWNhbCcsICduYXR1cmFsJywgJ3RlY2gnLCAnY2xhc3NpYycsICdwbGF5ZnVsJywgJ2VsZWdhbnQnXVxuICAgICAgICB9LFxuICAgICAgICB2aXN1YWxDb25zaXN0ZW5jeUd1aWRlOiB7XG4gICAgICAgICAgdHlwZTogVHlwZS5PQkpFQ1QsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgY2hhcmFjdGVyVHJhaXRzOiB7IHR5cGU6IFR5cGUuQVJSQVksIGl0ZW1zOiB7IHR5cGU6IFR5cGUuU1RSSU5HIH0gfSxcbiAgICAgICAgICAgIG9iamVjdFRyYWl0czogeyB0eXBlOiBUeXBlLkFSUkFZLCBpdGVtczogeyB0eXBlOiBUeXBlLlNUUklORyB9IH0sXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU3R5bGU6IHsgdHlwZTogVHlwZS5TVFJJTkcgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVxdWlyZWQ6IFtcImNoYXJhY3RlclRyYWl0c1wiLCBcIm9iamVjdFRyYWl0c1wiLCBcImJhY2tncm91bmRTdHlsZVwiXVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVxdWlyZWQ6IFtcInRpdGxlXCIsIFwidGFyZ2V0QWdlXCIsIFwibWFpblRoZW1lXCIsIFwiZWR1Y2F0aW9uYWxNZXNzYWdlXCIsIFwibWFpbkNoYXJhY3RlckRlc2NyaXB0aW9uXCIsIFwibWFpbkNoYXJhY3RlckRpc3RpbmN0aXZlTWFya1wiLCBcImFydFN0eWxlXCIsIFwia2V5T2JqZWN0RGVzY3JpcHRpb25cIiwgXCJ0aXRsZVByaW1hcnlDb2xvclwiLCBcInRpdGxlU2Vjb25kYXJ5Q29sb3JcIiwgXCJ0aXRsZUVmZmVjdFRoZW1lXCIsIFwidmlzdWFsQ29uc2lzdGVuY3lHdWlkZVwiXSxcbiAgICB9LFxuICAgIHBhZ2VzOiB7XG4gICAgICB0eXBlOiBUeXBlLkFSUkFZLFxuICAgICAgaXRlbXM6IHtcbiAgICAgICAgdHlwZTogVHlwZS5PQkpFQ1QsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBwYWdlTnVtYmVyOiB7IHR5cGU6IFR5cGUuSU5URUdFUiB9LFxuICAgICAgICAgIGhlYnJld1RleHQ6IHsgdHlwZTogVHlwZS5TVFJJTkcgfSxcbiAgICAgICAgICBpbWFnZVByb21wdDoge1xuICAgICAgICAgICAgdHlwZTogVHlwZS5TVFJJTkcsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJEZXRhaWxlZCBFTkdMSVNIIHZpc3VhbCBzY2VuZSBkZXNjcmlwdGlvbi4gSU1QT1JUQU5UOiBEZXNjcmliZSBhIFNQRUNJRklDIENBTUVSQSBBTkdMRSAoZS5nLiwgJ0Nsb3NlLXVwIG9uIGZhY2UnLCAnV2lkZSBzaG90IGZyb20gYWJvdmUnLCAnTG93IGFuZ2xlIGxvb2tpbmcgdXAnKSBhbmQgU1BFQ0lGSUMgQkFDS0dST1VORCBERVRBSUxTIHJlbGV2YW50IHRvIHRoZSBhY3Rpb24uIERvIE5PVCBqdXN0IHNheSAnaW4gdGhlIGZvcmVzdCcuIFNheSAnbmV4dCB0byBhIGdpYW50IG9hayB0cmVlIHdpdGggc3VubGlnaHQgZmlsdGVyaW5nIHRocm91Z2gnLlwiXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWlyZWQ6IFtcInBhZ2VOdW1iZXJcIiwgXCJoZWJyZXdUZXh0XCIsIFwiaW1hZ2VQcm9tcHRcIl0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0sXG4gIHJlcXVpcmVkOiBbXCJtZXRhZGF0YVwiLCBcInBhZ2VzXCJdLFxufTtcblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlU3RvcnlJZGVhID0gYXN5bmMgKGFnZVJhbmdlOiBzdHJpbmcsIGN1cnJlbnRUb3BpYzogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcbiAgY29uc3QgYWkgPSBuZXcgR29vZ2xlR2VuQUkoeyBhcGlLZXk6IGdldEFwaUtleSgpIH0pO1xuICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhIGNyZWF0aXZlIGNoaWxkcmVuJ3MgYm9vayBlZGl0b3IuIFxuICBUaGUgdXNlciB3YW50cyBhbiBpZGVhIGZvciBhIGJvb2suXG4gIFRhcmdldCBBZ2U6ICR7YWdlUmFuZ2V9XG4gIFVzZXIncyByb3VnaCBpZGVhIChvcHRpb25hbCk6IFwiJHtjdXJyZW50VG9waWN9XCJcblxuICBQbGVhc2UgZ2VuZXJhdGUgYSBzaG9ydCwgc3RydWN0dXJlZCBjb25jZXB0IGluIEhFQlJFVyAo16LXkdeo15nXqikuXG4gIFN0cnVjdHVyZTpcbiAgMS4g16nXnSDXlNeh16TXqCAoVGl0bGUpXG4gIDIuINeT157XldeqINeo15DXqdeZ16ogKE1haW4gQ2hhcmFjdGVyIC0gTmFtZSArIEEgdW5pcXVlIHZpc3VhbCB0cmFpdC9tYXJrKVxuICAzLiDXqten16bXmdeoINeU16LXnNeZ15zXlCAoU2hvcnQgUGxvdCBTdW1tYXJ5KVxuICBcbiAgTWFrZSBpdCBlbmdhZ2luZywgbWFnaWNhbCwgYW5kIHN1aXRhYmxlIGZvciB0aGUgYWdlIGdyb3VwLiBcbiAgRG8gbm90IGluY2x1ZGUgbWFya2Rvd24gZm9ybWF0dGluZyBsaWtlICoqIG9yICMjLiBKdXN0IGNsZWFuIHRleHQuYDtcblxuICB0cnkge1xuICAgIC8vIFVzaW5nIGZsYXNoIGZvciBzcGVlZFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmV0cnlXaXRoQmFja29mZjxHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZT4oKCkgPT4gYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICBtb2RlbDogJ2dlbWluaS0zLWZsYXNoLXByZXZpZXcnLFxuICAgICAgY29udGVudHM6IHsgcGFydHM6IFt7IHRleHQ6IHByb21wdCB9XSB9LFxuICAgICAgY29uZmlnOiB7XG4gICAgICAgIG1heE91dHB1dFRva2VuczogMzAwLFxuICAgICAgfVxuICAgIH0pKTtcbiAgICByZXR1cm4gcmVzcG9uc2UudGV4dCB8fCBcIlwiO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdlbmVyYXRpbmcgaWRlYTpcIiwgZXJyb3IpO1xuICAgIC8vIElmIGhhbmRsZUZhdGFsRXJyb3IgcmV0dXJucyB0cnVlLCBpdCdzIGEgY3JpdGljYWwgYXV0aC9xdW90YSBlcnJvciBhbmQgd2UgbGV0IHRoZSBVSSByZWRpcmVjdC5cbiAgICAvLyBJZiBpdCByZXR1cm5zIGZhbHNlLCB3ZSB0aHJvdyBzbyB0aGUgY29tcG9uZW50IGNhbiBzaG93IGEgc3BlY2lmaWMgYWxlcnQuXG4gICAgaWYgKCFoYW5kbGVGYXRhbEVycm9yKGVycm9yKSkge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICAgIHJldHVybiBcIlwiO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVCb29rQ29udGVudCA9IGFzeW5jIChyZXF1ZXN0OiBCb29rUmVxdWVzdCk6IFByb21pc2U8Qm9vaz4gPT4ge1xuICAvLyBDb3B5cmlnaHQgY2hlY2sgYmVmb3JlIGdlbmVyYXRpb25cbiAgY29uc3QgeyB2YWxpZGF0ZUJvb2tSZXF1ZXN0LCBsb2dHZW5lcmF0ZWRCb29rIH0gPSBhd2FpdCBpbXBvcnQoJy4vcHJvbXB0R3VhcmQnKTtcbiAgY29uc3QgY29weXJpZ2h0Q2hlY2sgPSBhd2FpdCB2YWxpZGF0ZUJvb2tSZXF1ZXN0KHJlcXVlc3QudG9waWMpO1xuICBpZiAoIWNvcHlyaWdodENoZWNrLmFsbG93ZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoY29weXJpZ2h0Q2hlY2sucmVhc29uIHx8ICdDb250ZW50IGJsb2NrZWQnKTtcbiAgfVxuXG4gIGNvbnN0IGFpID0gbmV3IEdvb2dsZUdlbkFJKHsgYXBpS2V5OiBnZXRBcGlLZXkoKSB9KTtcbiAgY29uc3Qgc3lzdGVtSW5zdHJ1Y3Rpb24gPSBgWW91IGFyZSBhIHdvcmxkLWNsYXNzIGNoaWxkcmVuJ3MgYm9vayBhdXRob3IgYW5kIGFydCBkaXJlY3Rvci5cbiAgXG4gIFRBU0s6IENyZWF0ZSBhIG1hZ2ljYWwgY2hpbGRyZW4ncyBib29rIGluIEhlYnJldyB3aXRoIGRldGFpbGVkIEVuZ2xpc2ggYXJ0IGRpcmVjdGlvbi5cbiAgXG4gIFNUUklDVCBQQUdFIENPVU5UOiBFWEFDVExZICR7cmVxdWVzdC5wYWdlQ291bnR9IHBhZ2VzLlxuICBcbiAgR1VJREVMSU5FUzpcbiAgMS4gU1RPUlkgKEhlYnJldyk6IEVuZ2FnaW5nLCBhZ2UtYXBwcm9wcmlhdGUsIHBlcmZlY3QgZ3JhbW1hci5cbiAgICAgLSBDUklUSUNBTDogVGhlICd0aXRsZScgaW4gbWV0YWRhdGEgTVVTVCBiZSBpbiBIZWJyZXcgT05MWS4gRG8gbm90IGluY2x1ZGUgYW4gRW5nbGlzaCB0cmFuc2xhdGlvbi5cbiAgMi4gQVJUIERJUkVDVElPTiAoRW5nbGlzaCk6XG4gICAgIC0gJ21haW5DaGFyYWN0ZXJEZXNjcmlwdGlvbic6IEEgcHJlY2lzZSwgdW5jaGFuZ2luZyB2aXN1YWwgZGVmaW5pdGlvbi5cbiAgICAgLSAnbWFpbkNoYXJhY3RlckRpc3RpbmN0aXZlTWFyayc6IENSRUFURSBBIFVOSVFVRSBJREVOVElGSUVSIChlLmcuLCBcIlJhaW5ib3cgU2NhcmZcIiwgXCJHb2xkZW4gR29nZ2xlc1wiKS4gVGhpcyBpcyBDUklUSUNBTCBmb3IgY29uc2lzdGVuY3kuXG4gICAgIC0gJ3Zpc3VhbENvbnNpc3RlbmN5R3VpZGUnOiBMaXN0IHNwZWNpZmljIGl0ZW1zL2NvbG9ycyB0aGF0IE1VU1QgYXBwZWFyIGluIGV2ZXJ5IGltYWdlLlxuICAgICAtICdpbWFnZVByb21wdCcgKGZvciBlYWNoIHBhZ2UpOiBBIEZVTEwgU0NFTkUgREVTQ1JJUFRJT04uIFxuICAzLiBWSVNVQUwgVkFSSUVUWSAoQ1JJVElDQUwpOlxuICAgICAtICoqVkFSWSBDQU1FUkEgQU5HTEVTKio6IERvIE5PVCB1c2UgdGhlIHNhbWUgXCJtZWRpdW0gc2hvdFwiIGZvciBldmVyeSBwYWdlLiBVc2UgQ2xvc2UtdXBzLCBXaWRlIHNob3RzLCBCaXJkJ3MtZXllIHZpZXcsIExvdyBhbmdsZXMuXG4gICAgIC0gKipWQVJZIEJBQ0tHUk9VTkRTKio6IEV2ZW4gaWYgdGhlIHNldHRpbmcgaXMgdGhlIHNhbWUgKGUuZy4sIGEgZm9yZXN0KSwgZm9jdXMgb24gRElGRkVSRU5UIHBhcnRzIG9mIGl0IChlLmcuLCBcIm5leHQgdG8gYSBzdHJlYW1cIiwgXCJpbnNpZGUgYSBob2xsb3cgbG9nXCIsIFwibG9va2luZyB1cCBhdCB0aGUgY2Fub3B5XCIpLlxuICAgICAtICoqRFlOQU1JQyBBQ1RJT04qKjogQ2hhcmFjdGVycyBzaG91bGQgYmUgZG9pbmcgZGlmZmVyZW50IHRoaW5ncywgbm90IGp1c3Qgc3RhbmRpbmcuXG4gIDQuIENPTVBPU0lUSU9OIEFXQVJFTkVTUzpcbiAgICAgLSBUaGUgaW1hZ2VzIG11c3QgYmUgRlVMTCBCTEVFRCwgZmlsbGluZyB0aGUgZW50aXJlIHNxdWFyZSAxOjEgY2FudmFzLlxuICAgICAtIENlbnRlciB0aGUgYWN0aW9uLlxuICAgICAtIERvIE5PVCBsZWF2ZSBlbXB0eSBzcGFjZSBmb3IgdGV4dC4gVGV4dCB3aWxsIGJlIGFkZGVkIGV4dGVybmFsbHkuXG4gIGA7XG5cbiAgbGV0IHByb21wdCA9IGBDcmVhdGUgYSBjaGlsZHJlbidzIGJvb2suXG4gIFRhcmdldCBBZ2U6ICR7cmVxdWVzdC5hZ2VSYW5nZX1cbiAgVG9waWM6ICR7cmVxdWVzdC50b3BpY31cbiAgUkVRVUlSRUQgTEVOR1RIOiBFWEFDVExZICR7cmVxdWVzdC5wYWdlQ291bnR9IHBhZ2VzLiBTdGFydCB3aXRoIHBhZ2UgMSBhcyB0aGUgY292ZXIgYW5kIGVuZCB3aXRoIHBhZ2UgJHtyZXF1ZXN0LnBhZ2VDb3VudH0uXG4gIEFydCBTdHlsZSBTZWxlY3Rpb246ICR7cmVxdWVzdC5hcnRTdHlsZX1gO1xuXG4gIGlmIChyZXF1ZXN0LnByZXZpb3VzQ29udGV4dCkge1xuICAgIHByb21wdCArPSBgXG4gICAgU0VRVUVMIE1PREU6IE1haW50YWluIGNoYXJhY3RlciBjb25zaXN0ZW5jeSB3aXRoIHRoZSBwcmV2aW91cyBzdG9yeTogXCIke3JlcXVlc3QucHJldmlvdXNDb250ZXh0LnRpdGxlfVwiLlxuICAgIFByZXZpb3VzIE1haW4gQ2hhcmFjdGVyOiAke3JlcXVlc3QucHJldmlvdXNDb250ZXh0LmNoYXJhY3RlckRlc2NyaXB0aW9ufS5cbiAgICAke3JlcXVlc3QucHJldmlvdXNDb250ZXh0LnNlY29uZGFyeUNoYXJhY3RlckRlc2NyaXB0aW9uID8gYFByZXZpb3VzIFNlY29uZGFyeSBDaGFyYWN0ZXI6ICR7cmVxdWVzdC5wcmV2aW91c0NvbnRleHQuc2Vjb25kYXJ5Q2hhcmFjdGVyRGVzY3JpcHRpb259YCA6ICcnfVxuICAgIGA7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmV0cnlXaXRoQmFja29mZjxHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZT4oKCkgPT4gYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICBtb2RlbDogJ2dlbWluaS0zLXByby1wcmV2aWV3JyxcbiAgICAgIGNvbnRlbnRzOiBwcm9tcHQsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcmVzcG9uc2VNaW1lVHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICByZXNwb25zZVNjaGVtYTogYm9va1NjaGVtYSxcbiAgICAgICAgc3lzdGVtSW5zdHJ1Y3Rpb246IHN5c3RlbUluc3RydWN0aW9uLFxuICAgICAgfVxuICAgIH0pKTtcblxuICAgIGlmICghcmVzcG9uc2UudGV4dCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdlbmVyYXRlIGJvb2sgY29udGVudFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBib29rID0gSlNPTi5wYXJzZShyZXNwb25zZS50ZXh0KSBhcyBCb29rO1xuXG4gICAgLy8gU2FmZXR5IGNoZWNrIGZvciBwYWdlIGNvdW50XG4gICAgY29uc29sZS5sb2coYFJlcXVlc3RlZCAke3JlcXVlc3QucGFnZUNvdW50fSBwYWdlcywgcmVjZWl2ZWQgJHtib29rLnBhZ2VzLmxlbmd0aH0gcGFnZXMuYCk7XG5cbiAgICAvLyBJbmplY3QgQXVkaW8gQ29uZmlndXJhdGlvbiBmcm9tIFJlcXVlc3RcbiAgICBib29rLm1ldGFkYXRhLmF1ZGlvQ29uZmlnID0ge1xuICAgICAgZW5hYmxlZDogcmVxdWVzdC5hdWRpb0VuYWJsZWQsXG4gICAgICB2b2ljZU5hbWU6IHJlcXVlc3Qudm9pY2VOYW1lXG4gICAgfTtcblxuICAgIGlmIChyZXF1ZXN0LnByZXZpb3VzQ29udGV4dD8uYmFzZUNoYXJhY3RlckltYWdlKSB7XG4gICAgICBib29rLm1ldGFkYXRhLmJhc2VDaGFyYWN0ZXJJbWFnZVVybCA9IHJlcXVlc3QucHJldmlvdXNDb250ZXh0LmJhc2VDaGFyYWN0ZXJJbWFnZTtcbiAgICB9XG5cbiAgICAvLyBSZWZpbmUgYWxsIGltYWdlIHByb21wdHMgdG8gaW5jbHVkZSB0aGUgY29uc2lzdGVuY3kgZ3VpZGUgZm9yIEJPVEggY2hhcmFjdGVyc1xuICAgIGNvbnN0IHRyYWl0cyA9IGJvb2subWV0YWRhdGEudmlzdWFsQ29uc2lzdGVuY3lHdWlkZS5jaGFyYWN0ZXJUcmFpdHMuam9pbihcIiwgXCIpO1xuICAgIGNvbnN0IG9ialRyYWl0cyA9IGJvb2subWV0YWRhdGEudmlzdWFsQ29uc2lzdGVuY3lHdWlkZS5vYmplY3RUcmFpdHMuam9pbihcIiwgXCIpO1xuICAgIGNvbnN0IG1haW5NYXJrID0gYm9vay5tZXRhZGF0YS5tYWluQ2hhcmFjdGVyRGlzdGluY3RpdmVNYXJrIHx8IFwiRGlzdGluY3RpdmUgZmVhdHVyZVwiO1xuICAgIGNvbnN0IHNlY01hcmsgPSBib29rLm1ldGFkYXRhLnNlY29uZGFyeUNoYXJhY3RlckRpc3RpbmN0aXZlTWFyaztcblxuICAgIGJvb2sucGFnZXMgPSBib29rLnBhZ2VzLm1hcCgocGFnZSwgaWR4KSA9PiB7XG4gICAgICAvLyAxLiBFc3RhYmxpc2ggdGhlIHZpc3VhbCBhbmNob3IgKENoYXJhY3RlcnMgJiBTdHlsZSlcbiAgICAgIGxldCByZWZpbmVkUHJvbXB0ID0gYFtNQUlOIENIQVJBQ1RFUl06ICR7Ym9vay5tZXRhZGF0YS5tYWluQ2hhcmFjdGVyRGVzY3JpcHRpb259LiBESVNUSU5DVElWRSBGRUFUVVJFOiAke21haW5NYXJrfS4gS2V5IEZlYXR1cmVzOiAke3RyYWl0c30uIGA7XG5cbiAgICAgIGlmIChib29rLm1ldGFkYXRhLnNlY29uZGFyeUNoYXJhY3RlckRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHJlZmluZWRQcm9tcHQgKz0gYFtTRUNPTkRBUlkgQ0hBUkFDVEVSXTogJHtib29rLm1ldGFkYXRhLnNlY29uZGFyeUNoYXJhY3RlckRlc2NyaXB0aW9ufS4gRElTVElOQ1RJVkUgRkVBVFVSRTogJHtzZWNNYXJrIHx8ICdOb25lJ30uIGA7XG4gICAgICB9XG5cbiAgICAgIC8vIDIuIFNldCB0aGUgRW52aXJvbm1lbnQvQXRtb3NwaGVyZSBcbiAgICAgIC8vIE5PVEU6IFdlIGxhYmVsIHRoaXMgXCJHZW5lcmFsIENvbnRleHRcIiBzbyBpdCBkb2Vzbid0IG92ZXJyaWRlIHRoZSBzcGVjaWZpYyBzY2VuZSBhY3Rpb25cbiAgICAgIHJlZmluZWRQcm9tcHQgKz0gYFtHRU5FUkFMIENPTlRFWFRdOiAke2Jvb2subWV0YWRhdGEudmlzdWFsQ29uc2lzdGVuY3lHdWlkZS5iYWNrZ3JvdW5kU3R5bGV9LiBgO1xuICAgICAgaWYgKG9ialRyYWl0cykgcmVmaW5lZFByb21wdCArPSBgW1BST1BTXTogJHtvYmpUcmFpdHN9LiBgO1xuXG4gICAgICAvLyAzLiBEZWZpbmUgdGhlIHNwZWNpZmljIHNjZW5lIGFjdGlvbiAtIFRISVMgSVMgUFJJT1JJVFlcbiAgICAgIHJlZmluZWRQcm9tcHQgKz0gYFtTUEVDSUZJQyBTQ0VORSBBQ1RJT04gJiBBTkdMRV06ICR7cGFnZS5pbWFnZVByb21wdH0uIGA7XG5cbiAgICAgIHJldHVybiB7IC4uLnBhZ2UsIGltYWdlUHJvbXB0OiByZWZpbmVkUHJvbXB0IH07XG4gICAgfSk7XG5cbiAgICAvLyBEb24ndCBzYXZlIGhlcmUgLSBzYXZlZCBkdXJpbmcgZXhwb3J0IGluc3RlYWRcbiAgICByZXR1cm4gYm9vaztcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZW5lcmF0aW5nIGJvb2sgY29udGVudDpcIiwgZXJyb3IpO1xuICAgIC8vIEV4dHJhIGNhdGNoIGp1c3QgaW4gY2FzZSByZXRyeVdpdGhCYWNrb2ZmIGRpZG4ndCBjYXRjaCBpdFxuICAgIGhhbmRsZUZhdGFsRXJyb3IoZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVQYWdlSW1hZ2UgPSBhc3luYyAoXG4gIGFjdGlvblByb21wdDogc3RyaW5nLFxuICBjaGFyYWN0ZXJEZXNjcmlwdGlvbjogc3RyaW5nLFxuICBhcnRTdHlsZTogc3RyaW5nLFxuICBiYXNlQ2hhcmFjdGVySW1hZ2VVcmw/OiBzdHJpbmcsXG4gIGlzQ292ZXI6IGJvb2xlYW4gPSBmYWxzZSxcbiAgdGV4dFRvUmVuZGVyPzogc3RyaW5nXG4pOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcbiAgY29uc3QgYWkgPSBuZXcgR29vZ2xlR2VuQUkoeyBhcGlLZXk6IGdldEFwaUtleSgpIH0pO1xuXG4gIGxldCBmaW5hbFByb21wdCA9IFwiXCI7XG4gIGxldCBtb2RlbE5hbWUgPSBcIlwiO1xuICBsZXQgaW1hZ2VDb25maWcgPSB7fTtcblxuICBpZiAoaXNDb3Zlcikge1xuICAgIC8vIENPVkVSIFNUUkFURUdZOiBVc2UgUHJvIG1vZGVsLCBiYWtlIHRleHQuXG4gICAgbW9kZWxOYW1lID0gJ2dlbWluaS0zLXByby1pbWFnZS1wcmV2aWV3JztcbiAgICBpbWFnZUNvbmZpZyA9IHsgYXNwZWN0UmF0aW86IFwiMToxXCIsIGltYWdlU2l6ZTogXCIxS1wiIH07XG5cbiAgICBmaW5hbFByb21wdCA9IGBcbiAgICAgIFtST0xFXTogRXhwZXJ0IENoaWxkcmVuJ3MgQm9vayBDb3ZlciBEZXNpZ25lci5cbiAgICAgIFtBUlQgU1RZTEVdOiAke2FydFN0eWxlfS5cbiAgICAgIFxuICAgICAgW0NBU1QgREVGSU5JVElPTlNdOiBcbiAgICAgICR7Y2hhcmFjdGVyRGVzY3JpcHRpb259XG4gICAgICBcbiAgICAgIFtTQ0VORSBERVNDUklQVElPTl06ICR7YWN0aW9uUHJvbXB0fVxuICAgICAgXG4gICAgICBbVElUTEUgVEVYVCAtIEFCU09MVVRFIFJFUVVJUkVNRU5UXTpcbiAgICAgIFRoZSBPTkxZIHRleHQgaW4gdGhpcyBlbnRpcmUgaW1hZ2UgaXM6IFwiJHt0ZXh0VG9SZW5kZXJ9XCJcbiAgICAgIFxuICAgICAgQ1JJVElDQUwgLSBURVhUIFJVTEVTOlxuICAgICAgMS4gT05MWSBkaXNwbGF5IHRoZSBleGFjdCB0aXRsZSBhYm92ZSAtIE5PIG90aGVyIHRleHQgd2hhdHNvZXZlclxuICAgICAgMi4gQUJTT0xVVEVMWSBOTzogc3VidGl0bGUsIGF1dGhvciwgYWdlIHJhbmdlLCBwYWdlIGNvdW50LCB0YWdsaW5lLCBkZXNjcmlwdGlvblxuICAgICAgMy4gQUJTT0xVVEVMWSBOTzogXCLXnteX15HXqFwiLCBcIteS15nXnFwiLCBcItei157XldeT15nXnVwiLCBudW1iZXJzLCBjcmVkaXRzLCB3YXRlcm1hcmtzXG4gICAgICA0LiBBQlNPTFVURUxZIE5POiBFbmdsaXNoIHRleHQsIExhdGluIGxldHRlcnMsIGFueSB0ZXh0IG5vdCBpbiB0aGUgdGl0bGVcbiAgICAgIDUuIFRoZSB0aXRsZSBzaG91bGQgYmUgaW4gdGhlIFRPUCBUSElSRCBvZiB0aGUgaW1hZ2VcbiAgICAgIDYuIFVzZSBhcnRpc3RpYyBIZWJyZXcgZm9udCBtYXRjaGluZyAke2FydFN0eWxlfSBzdHlsZVxuICAgICAgNy4gQWRkIGdsb3cvc2hhZG93IGJlaGluZCB0ZXh0IGZvciByZWFkYWJpbGl0eVxuICAgICAgXG4gICAgICBbQ0hBUkFDVEVSXTpcbiAgICAgIDEuIE1haW4gY2hhcmFjdGVyIG11c3QgbWF0Y2ggUmVmZXJlbmNlIEltYWdlIChpZiBwcm92aWRlZClcbiAgICAgIDIuIENoYXJhY3RlciBpbiBkeW5hbWljLCBpbnZpdGluZyBwb3NlXG4gICAgICBcbiAgICAgIFtURUNITklDQUxdOiA4ayByZXNvbHV0aW9uLCBjaW5lbWF0aWMgbGlnaHRpbmcsIHZpdmlkIGNvbG9ycy5cbiAgICAgIFtORUdBVElWRSBQUk9NUFRdOiBzdWJ0aXRsZSwgYXV0aG9yIG5hbWUsIHBhZ2UgY291bnQsIGFnZSByYW5nZSwgRW5nbGlzaCB0ZXh0LCBleHRyYSB0ZXh0LCB3YXRlcm1hcmssIHRhZ2xpbmUsIGNyZWRpdHMsINee15fXkdeoLCDXkteZ15wsINei157XldeT15nXnSwgbnVtYmVycyBhdCBib3R0b20sIGRlc2NyaXB0aW9uIHRleHQsIGFueSB0ZXh0IGJlc2lkZXMgdGl0bGUuXG4gICAgYDtcbiAgfSBlbHNlIHtcbiAgICAvLyBJTk5FUiBQQUdFIFNUUkFURUdZOiBVc2UgRmxhc2ggbW9kZWwsIE5PIHRleHQuXG4gICAgbW9kZWxOYW1lID0gJ2dlbWluaS0yLjUtZmxhc2gtaW1hZ2UnO1xuXG4gICAgLy8gRW5oYW5jZWQgcHJvbXB0IHdpdGggc3Ryb25nZXIgY2hhcmFjdGVyIGNvbnNpc3RlbmN5XG4gICAgZmluYWxQcm9tcHQgPSBgXG4gICAgICBbUk9MRV06IFByb2Zlc3Npb25hbCBDaGlsZHJlbidzIEJvb2sgSWxsdXN0cmF0b3Igc3BlY2lhbGl6aW5nIGluIGNoYXJhY3RlciBjb25zaXN0ZW5jeS5cbiAgICAgIFtBUlQgU1RZTEVdOiAke2FydFN0eWxlfS5cbiAgICAgIFxuICAgICAgW0NBU1QgREVGSU5JVElPTlMgLSBDUklUSUNBTCBGT1IgQ09OU0lTVEVOQ1ldOiBcbiAgICAgICR7Y2hhcmFjdGVyRGVzY3JpcHRpb259XG4gICAgICBcbiAgICAgIFtTQ0VORSBUTyBJTExVU1RSQVRFXTogXG4gICAgICAke2FjdGlvblByb21wdH1cbiAgICAgIFxuICAgICAgW0NIQVJBQ1RFUiBDT05TSVNURU5DWSAtIE1BTkRBVE9SWV06XG4gICAgICAxLiBTQU1FIENIQVJBQ1RFUiA9IElERU5USUNBTCBBUFBFQVJBTkNFIGluIGV2ZXJ5IGlsbHVzdHJhdGlvblxuICAgICAgMi4gTWFpbiBjaGFyYWN0ZXIgTVVTVCBoYXZlIHRoZSBFWEFDVCBzYW1lOlxuICAgICAgICAgLSBGYWNlIHNoYXBlIGFuZCBmZWF0dXJlc1xuICAgICAgICAgLSBIYWlyIGNvbG9yIGFuZCBzdHlsZVxuICAgICAgICAgLSBDbG90aGluZyBhbmQgYWNjZXNzb3JpZXNcbiAgICAgICAgIC0gQW55IGRpc3RpbmN0aXZlIG1hcmtzIG1lbnRpb25lZCBpbiBDQVNUIERFRklOSVRJT05TXG4gICAgICAzLiBJZiBhIFJlZmVyZW5jZSBJbWFnZSBpcyBwcm92aWRlZCwgdGhlIGNoYXJhY3RlciBNVVNUIG1hdGNoIGl0IEVYQUNUTFlcbiAgICAgIDQuIFNlY29uZGFyeSBjaGFyYWN0ZXIgKGlmIHByZXNlbnQpIG11c3QgYWxzbyBiZSBjb25zaXN0ZW50XG4gICAgICA1LiBETyBOT1QgY2hhbmdlIGNoYXJhY3RlciBhcHBlYXJhbmNlIGJldHdlZW4gcGFnZXNcbiAgICAgIFxuICAgICAgW0lMTFVTVFJBVElPTiBSVUxFU106XG4gICAgICAxLiAqKkFCU09MVVRFTFkgTk8gVEVYVCoqOiBObyB0ZXh0LCBjYXB0aW9ucywgc3BlZWNoIGJ1YmJsZXMsIG9yIHdvcmRzXG4gICAgICAyLiAqKkZVTEwgQkxFRUQqKjogVXNlIGVudGlyZSBjYW52YXMsIG5vIGJvcmRlcnMgb3IgbWFyZ2luc1xuICAgICAgMy4gKipEWU5BTUlDIENPTVBPU0lUSU9OKio6IFVzZSB0aGUgY2FtZXJhIGFuZ2xlIHNwZWNpZmllZCBpbiB0aGUgc2NlbmUgZGVzY3JpcHRpb25cbiAgICAgIFxuICAgICAgW0JBQ0tHUk9VTkQgSU5TVFJVQ1RJT05dOiBcbiAgICAgIE1hdGNoIGJhY2tncm91bmQgdG8gdGhlIHNwZWNpZmljIHNjZW5lIGFjdGlvbiBkZXNjcmliZWQgYWJvdmUuXG4gICAgICBVc2UgdmFyaWVkIGNhbWVyYSBhbmdsZXMgKENsb3NlLXVwLCBXaWRlIHNob3QsIExvdyBhbmdsZSkgZm9yIHZpc3VhbCB2YXJpZXR5LlxuICAgICAgXG4gICAgICBbVEVDSE5JQ0FMIFNQRUNTXTogOGsgcmVzb2x1dGlvbiwgY2luZW1hdGljIGxpZ2h0aW5nLCB2aXZpZCBzYXR1cmF0ZWQgY29sb3JzLlxuICAgICAgW05FR0FUSVZFXTogdGV4dCwgd3JpdGluZywgbGV0dGVycywgd29yZHMsIHdhdGVybWFyaywgbG9nbywgYmx1cnJ5LCBsb3cgcXVhbGl0eSwgaW5jb25zaXN0ZW50IGNoYXJhY3RlciwgZGlmZmVyZW50IG91dGZpdCwgY2hhbmdlZCBhcHBlYXJhbmNlLlxuICAgIGA7XG4gIH1cblxuICBjb25zdCBwYXJ0czogYW55W10gPSBbeyB0ZXh0OiBmaW5hbFByb21wdCB9XTtcblxuICAvLyBJZiB3ZSBoYXZlIGEgYmFzZSBjaGFyYWN0ZXIgaW1hZ2UsIHdlIE1VU1Qgc2VuZCBpdCBhcyBhIHJlZmVyZW5jZSBmb3IgRVZFUlkgcGFnZVxuICBpZiAoYmFzZUNoYXJhY3RlckltYWdlVXJsICYmIGJhc2VDaGFyYWN0ZXJJbWFnZVVybC5zdGFydHNXaXRoKCdkYXRhOmltYWdlLycpKSB7XG4gICAgY29uc3QgbWF0Y2hlcyA9IGJhc2VDaGFyYWN0ZXJJbWFnZVVybC5tYXRjaCgvXmRhdGE6KC4rKTtiYXNlNjQsKC4rKSQvKTtcbiAgICBpZiAobWF0Y2hlcykge1xuICAgICAgcGFydHMudW5zaGlmdCh7XG4gICAgICAgIGlubGluZURhdGE6IHtcbiAgICAgICAgICBtaW1lVHlwZTogbWF0Y2hlc1sxXSxcbiAgICAgICAgICBkYXRhOiBtYXRjaGVzWzJdXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcGFydHMucHVzaCh7IHRleHQ6IFwiUkVGRVJFTkNFIElNQUdFIElOU1RSVUNUSU9OOiBUaGUgaW1hZ2UgYWJvdmUgaXMgdGhlIE1BSU4gY2hhcmFjdGVyIHJlZmVyZW5jZS4gTWF0Y2ggdGhpcyBjaGFyYWN0ZXIgZXhhY3RseS5cIiB9KTtcbiAgICB9XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmV0cnlXaXRoQmFja29mZjxHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZT4oKCkgPT4gYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICBtb2RlbDogbW9kZWxOYW1lLFxuICAgICAgY29udGVudHM6IHsgcGFydHMgfSxcbiAgICAgIGNvbmZpZzogaXNDb3ZlciA/IHsgaW1hZ2VDb25maWcgfSA6IHVuZGVmaW5lZFxuICAgIH0pKTtcblxuICAgIGZvciAoY29uc3QgY2FuZGlkYXRlIG9mIHJlc3BvbnNlLmNhbmRpZGF0ZXMgfHwgW10pIHtcbiAgICAgIGZvciAoY29uc3QgcGFydCBvZiBjYW5kaWRhdGUuY29udGVudC5wYXJ0cykge1xuICAgICAgICBpZiAocGFydC5pbmxpbmVEYXRhICYmIHBhcnQuaW5saW5lRGF0YS5kYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIGBkYXRhOiR7cGFydC5pbmxpbmVEYXRhLm1pbWVUeXBlfTtiYXNlNjQsJHtwYXJ0LmlubGluZURhdGEuZGF0YX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdlbmVyYXRpbmcgaW1hZ2U6XCIsIGVycm9yKTtcbiAgICBoYW5kbGVGYXRhbEVycm9yKGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGFuYWx5emVCb29rUGRmID0gYXN5bmMgKHBkZkJhc2U2NDogc3RyaW5nKTogUHJvbWlzZTxQcmV2aW91c0Jvb2tDb250ZXh0PiA9PiB7XG4gIGNvbnN0IGFpID0gbmV3IEdvb2dsZUdlbkFJKHsgYXBpS2V5OiBnZXRBcGlLZXkoKSB9KTtcblxuICBjb25zdCBwcm9tcHQgPSBgXG4gICAgQW5hbHl6ZSB0aGlzIFBERiBjaGlsZHJlbidzIGJvb2suIFxuICAgIEV4dHJhY3QgdGhlIGZvbGxvd2luZyBpbmZvcm1hdGlvbiB0byBjcmVhdGUgYSBzZXF1ZWwgY29udGV4dDpcbiAgICAxLiBUaXRsZSBvZiB0aGUgYm9vay5cbiAgICAyLiBBIHN1bW1hcnkgb2YgdGhlIHBsb3QuXG4gICAgMy4gQSBkZXRhaWxlZCB2aXN1YWwgZGVzY3JpcHRpb24gb2YgdGhlIE1BSU4gY2hhcmFjdGVyIChhcHBlYXJhbmNlLCBjbG90aGVzLCBoYWlyLCBjb2xvcnMpLlxuICAgIDQuIEEgZGV0YWlsZWQgdmlzdWFsIGRlc2NyaXB0aW9uIG9mIGFueSBTRUNPTkRBUlkgY2hhcmFjdGVyIChzaWRla2ljaykgaWYgcHJlc2VudC5cbiAgICA1LiBUaGUgYXJ0IHN0eWxlIHVzZWQuXG4gICAgXG4gICAgUmV0dXJuIHRoZSByZXN1bHQgYXMgYSBKU09OIG9iamVjdC5cbiAgYDtcblxuICBjb25zdCBleHRyYWN0aW9uU2NoZW1hID0ge1xuICAgIHR5cGU6IFR5cGUuT0JKRUNULFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgIHRpdGxlOiB7IHR5cGU6IFR5cGUuU1RSSU5HIH0sXG4gICAgICBzdW1tYXJ5OiB7IHR5cGU6IFR5cGUuU1RSSU5HIH0sXG4gICAgICBjaGFyYWN0ZXJEZXNjcmlwdGlvbjogeyB0eXBlOiBUeXBlLlNUUklORyB9LFxuICAgICAgc2Vjb25kYXJ5Q2hhcmFjdGVyRGVzY3JpcHRpb246IHsgdHlwZTogVHlwZS5TVFJJTkcgfSxcbiAgICAgIGFydFN0eWxlOiB7IHR5cGU6IFR5cGUuU1RSSU5HIH0sXG4gICAgfSxcbiAgICByZXF1aXJlZDogW1widGl0bGVcIiwgXCJzdW1tYXJ5XCIsIFwiY2hhcmFjdGVyRGVzY3JpcHRpb25cIiwgXCJhcnRTdHlsZVwiXSxcbiAgfTtcblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmV0cnlXaXRoQmFja29mZjxHZW5lcmF0ZUNvbnRlbnRSZXNwb25zZT4oKCkgPT4gYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICBtb2RlbDogJ2dlbWluaS0zLWZsYXNoLXByZXZpZXcnLFxuICAgICAgY29udGVudHM6IHtcbiAgICAgICAgcGFydHM6IFtcbiAgICAgICAgICB7IGlubGluZURhdGE6IHsgbWltZVR5cGU6ICdhcHBsaWNhdGlvbi9wZGYnLCBkYXRhOiBwZGZCYXNlNjQgfSB9LFxuICAgICAgICAgIHsgdGV4dDogcHJvbXB0IH1cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIGNvbmZpZzoge1xuICAgICAgICByZXNwb25zZU1pbWVUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIHJlc3BvbnNlU2NoZW1hOiBleHRyYWN0aW9uU2NoZW1hXG4gICAgICB9XG4gICAgfSkpO1xuXG4gICAgaWYgKCFyZXNwb25zZS50ZXh0KSB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gYW5hbHl6ZSBQREZcIik7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UocmVzcG9uc2UudGV4dCkgYXMgUHJldmlvdXNCb29rQ29udGV4dDtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhbmFseXppbmcgUERGOlwiLCBlcnJvcik7XG4gICAgaGFuZGxlRmF0YWxFcnJvcihlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn07XG5cbi8vIEFVRElPIEdFTkVSQVRJT04gVVRJTFNcblxuLy8gRGVjb2RlIGJhc2U2NCB0byBiaW5hcnkgc3RyaW5nIHRvIFVpbnQ4QXJyYXkgdG8gSW50MTZBcnJheVxuZnVuY3Rpb24gZGVjb2RlQXVkaW8oYmFzZTY0OiBzdHJpbmcpOiBJbnQxNkFycmF5IHtcbiAgY29uc3QgYmluYXJ5U3RyaW5nID0gYXRvYihiYXNlNjQpO1xuICBjb25zdCBsZW4gPSBiaW5hcnlTdHJpbmcubGVuZ3RoO1xuICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbik7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICBieXRlc1tpXSA9IGJpbmFyeVN0cmluZy5jaGFyQ29kZUF0KGkpO1xuICB9XG4gIHJldHVybiBuZXcgSW50MTZBcnJheShieXRlcy5idWZmZXIpO1xufVxuXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVQYWdlQXVkaW8gPSBhc3luYyAodGV4dDogc3RyaW5nLCBhdWRpb0NvbnRleHQ6IEF1ZGlvQ29udGV4dCwgdm9pY2VOYW1lOiBzdHJpbmcgPSAnUHVjaycpOiBQcm9taXNlPEF1ZGlvQnVmZmVyIHwgbnVsbD4gPT4ge1xuICBjb25zdCBhaSA9IG5ldyBHb29nbGVHZW5BSSh7IGFwaUtleTogZ2V0QXBpS2V5KCkgfSk7XG5cbiAgLy8gVmFsaWRhdGUgYW5kIFRydW5jYXRlIFRleHRcbiAgaWYgKCF0ZXh0IHx8ICF0ZXh0LnRyaW0oKSkgcmV0dXJuIG51bGw7XG5cbiAgLy8gVHJ1bmNhdGUgdG8gfjUwMCBjaGFycyB0byBhdm9pZCA1MDAgSW50ZXJuYWwgRXJyb3IgZnJvbSBUVFMgbW9kZWwgd2hpY2ggaGFzIGlucHV0IGxpbWl0c1xuICBjb25zdCBzYWZlVGV4dCA9IHRleHQudHJpbSgpLnNsaWNlKDAsIDUwMCk7XG5cbiAgY29uc3QgcHJvbXB0ID0gYFJlYWQgdGhlIGZvbGxvd2luZyBIZWJyZXcgdGV4dCBjbGVhcmx5LCBzbG93bHksIGFuZCB3YXJtbHksIHN1aXRhYmxlIGZvciBhIGNoaWxkcmVuJ3MgYm9vayBzdG9yeXRlbGxpbmc6XG4gICAgXG4gICAgJHtzYWZlVGV4dH1gO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXRyeVdpdGhCYWNrb2ZmPEdlbmVyYXRlQ29udGVudFJlc3BvbnNlPigoKSA9PiBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHtcbiAgICAgIG1vZGVsOiBcImdlbWluaS0yLjUtZmxhc2gtcHJldmlldy10dHNcIixcbiAgICAgIGNvbnRlbnRzOiBbeyBwYXJ0czogW3sgdGV4dDogcHJvbXB0IH1dIH1dLFxuICAgICAgY29uZmlnOiB7XG4gICAgICAgIHJlc3BvbnNlTW9kYWxpdGllczogW01vZGFsaXR5LkFVRElPXSxcbiAgICAgICAgc3BlZWNoQ29uZmlnOiB7XG4gICAgICAgICAgdm9pY2VDb25maWc6IHtcbiAgICAgICAgICAgIHByZWJ1aWx0Vm9pY2VDb25maWc6IHsgdm9pY2VOYW1lOiB2b2ljZU5hbWUgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pKTtcblxuICAgIGNvbnN0IGJhc2U2NEF1ZGlvID0gcmVzcG9uc2UuY2FuZGlkYXRlcz8uWzBdPy5jb250ZW50Py5wYXJ0cz8uWzBdPy5pbmxpbmVEYXRhPy5kYXRhO1xuXG4gICAgaWYgKCFiYXNlNjRBdWRpbykgcmV0dXJuIG51bGw7XG5cbiAgICAvLyBEZWNvZGUgUENNIGRhdGFcbiAgICBjb25zdCBwY21EYXRhID0gZGVjb2RlQXVkaW8oYmFzZTY0QXVkaW8pO1xuXG4gICAgLy8gQ29udmVydCBJbnQxNiBQQ00gdG8gRmxvYXQzMiBmb3IgQXVkaW9Db250ZXh0ICgtMS4wIHRvIDEuMClcbiAgICBjb25zdCBmbG9hdDMyRGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkocGNtRGF0YS5sZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGNtRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgZmxvYXQzMkRhdGFbaV0gPSBwY21EYXRhW2ldIC8gMzI3NjguMDtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgQXVkaW8gQnVmZmVyIChNb25vLCAyNGtIeiBhcyBwZXIgc3RhbmRhcmQgR2VuQUkgb3V0cHV0IHVzdWFsbHksIGJ1dCBjb250ZXh0IHNhbXBsZSByYXRlIG1hdHRlcnMpXG4gICAgLy8gTm90ZTogVGhlIHJhdyBvdXRwdXQgaXMgdXN1YWxseSAyNDAwMEh6LlxuICAgIGNvbnN0IGF1ZGlvQnVmZmVyID0gYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlcigxLCBmbG9hdDMyRGF0YS5sZW5ndGgsIDI0MDAwKTtcbiAgICBhdWRpb0J1ZmZlci5nZXRDaGFubmVsRGF0YSgwKS5zZXQoZmxvYXQzMkRhdGEpO1xuXG4gICAgcmV0dXJuIGF1ZGlvQnVmZmVyO1xuXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2VuZXJhdGluZyBhdWRpbzpcIiwgZXJyb3IpO1xuXG4gICAgLy8gUHJvcGFnYXRlIGZhdGFsIGVycm9ycyB0byBwcm9tcHQga2V5IGNoYW5nZVxuICAgIGhhbmRsZUZhdGFsRXJyb3IoZXJyb3IpO1xuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5BSSIsIlR5cGUiLCJNb2RhbGl0eSIsImFwaUtleU1hbmFnZXIiLCJnZXRBcGlLZXkiLCJrZXkiLCJnZXRLZXkiLCJFcnJvciIsImhhbmRsZUZhdGFsRXJyb3IiLCJlcnIiLCJlcnJvck9iaiIsImVycm9yIiwibXNnIiwibWVzc2FnZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b0xvd2VyQ2FzZSIsInN0YXR1cyIsImNvZGUiLCJpc1F1b3RhIiwiaW5jbHVkZXMiLCJpc0F1dGgiLCJjb25zb2xlIiwid2FybiIsIndpbmRvdyIsImRpc3BhdGNoRXZlbnQiLCJDdXN0b21FdmVudCIsInJldHJ5V2l0aEJhY2tvZmYiLCJmbiIsInJldHJpZXMiLCJiYXNlRGVsYXkiLCJpc1JldHJ5YWJsZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImJvb2tTY2hlbWEiLCJ0eXBlIiwiT0JKRUNUIiwicHJvcGVydGllcyIsIm1ldGFkYXRhIiwidGl0bGUiLCJTVFJJTkciLCJkZXNjcmlwdGlvbiIsInRhcmdldEFnZSIsIm1haW5UaGVtZSIsImVkdWNhdGlvbmFsTWVzc2FnZSIsImFydFN0eWxlIiwibWFpbkNoYXJhY3RlckRlc2NyaXB0aW9uIiwibWFpbkNoYXJhY3RlckRpc3RpbmN0aXZlTWFyayIsInNlY29uZGFyeUNoYXJhY3RlckRlc2NyaXB0aW9uIiwic2Vjb25kYXJ5Q2hhcmFjdGVyRGlzdGluY3RpdmVNYXJrIiwia2V5T2JqZWN0RGVzY3JpcHRpb24iLCJ0aXRsZVByaW1hcnlDb2xvciIsInRpdGxlU2Vjb25kYXJ5Q29sb3IiLCJ0aXRsZUVmZmVjdFRoZW1lIiwiZW51bSIsInZpc3VhbENvbnNpc3RlbmN5R3VpZGUiLCJjaGFyYWN0ZXJUcmFpdHMiLCJBUlJBWSIsIml0ZW1zIiwib2JqZWN0VHJhaXRzIiwiYmFja2dyb3VuZFN0eWxlIiwicmVxdWlyZWQiLCJwYWdlcyIsInBhZ2VOdW1iZXIiLCJJTlRFR0VSIiwiaGVicmV3VGV4dCIsImltYWdlUHJvbXB0IiwiZ2VuZXJhdGVTdG9yeUlkZWEiLCJhZ2VSYW5nZSIsImN1cnJlbnRUb3BpYyIsImFpIiwiYXBpS2V5IiwicHJvbXB0IiwicmVzcG9uc2UiLCJtb2RlbHMiLCJnZW5lcmF0ZUNvbnRlbnQiLCJtb2RlbCIsImNvbnRlbnRzIiwicGFydHMiLCJ0ZXh0IiwiY29uZmlnIiwibWF4T3V0cHV0VG9rZW5zIiwiZ2VuZXJhdGVCb29rQ29udGVudCIsInJlcXVlc3QiLCJ2YWxpZGF0ZUJvb2tSZXF1ZXN0IiwibG9nR2VuZXJhdGVkQm9vayIsImNvcHlyaWdodENoZWNrIiwidG9waWMiLCJhbGxvd2VkIiwicmVhc29uIiwic3lzdGVtSW5zdHJ1Y3Rpb24iLCJwYWdlQ291bnQiLCJwcmV2aW91c0NvbnRleHQiLCJjaGFyYWN0ZXJEZXNjcmlwdGlvbiIsInJlc3BvbnNlTWltZVR5cGUiLCJyZXNwb25zZVNjaGVtYSIsImJvb2siLCJwYXJzZSIsImxvZyIsImxlbmd0aCIsImF1ZGlvQ29uZmlnIiwiZW5hYmxlZCIsImF1ZGlvRW5hYmxlZCIsInZvaWNlTmFtZSIsImJhc2VDaGFyYWN0ZXJJbWFnZSIsImJhc2VDaGFyYWN0ZXJJbWFnZVVybCIsInRyYWl0cyIsImpvaW4iLCJvYmpUcmFpdHMiLCJtYWluTWFyayIsInNlY01hcmsiLCJtYXAiLCJwYWdlIiwiaWR4IiwicmVmaW5lZFByb21wdCIsImdlbmVyYXRlUGFnZUltYWdlIiwiYWN0aW9uUHJvbXB0IiwiaXNDb3ZlciIsInRleHRUb1JlbmRlciIsImZpbmFsUHJvbXB0IiwibW9kZWxOYW1lIiwiaW1hZ2VDb25maWciLCJhc3BlY3RSYXRpbyIsImltYWdlU2l6ZSIsInN0YXJ0c1dpdGgiLCJtYXRjaGVzIiwibWF0Y2giLCJ1bnNoaWZ0IiwiaW5saW5lRGF0YSIsIm1pbWVUeXBlIiwiZGF0YSIsInB1c2giLCJ1bmRlZmluZWQiLCJjYW5kaWRhdGUiLCJjYW5kaWRhdGVzIiwicGFydCIsImNvbnRlbnQiLCJhbmFseXplQm9va1BkZiIsInBkZkJhc2U2NCIsImV4dHJhY3Rpb25TY2hlbWEiLCJzdW1tYXJ5IiwiZGVjb2RlQXVkaW8iLCJiYXNlNjQiLCJiaW5hcnlTdHJpbmciLCJhdG9iIiwibGVuIiwiYnl0ZXMiLCJVaW50OEFycmF5IiwiaSIsImNoYXJDb2RlQXQiLCJJbnQxNkFycmF5IiwiYnVmZmVyIiwiZ2VuZXJhdGVQYWdlQXVkaW8iLCJhdWRpb0NvbnRleHQiLCJ0cmltIiwic2FmZVRleHQiLCJzbGljZSIsInJlc3BvbnNlTW9kYWxpdGllcyIsIkFVRElPIiwic3BlZWNoQ29uZmlnIiwidm9pY2VDb25maWciLCJwcmVidWlsdFZvaWNlQ29uZmlnIiwiYmFzZTY0QXVkaW8iLCJwY21EYXRhIiwiZmxvYXQzMkRhdGEiLCJGbG9hdDMyQXJyYXkiLCJhdWRpb0J1ZmZlciIsImNyZWF0ZUJ1ZmZlciIsImdldENoYW5uZWxEYXRhIiwic2V0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./services/geminiService.ts\n"));

/***/ })

});